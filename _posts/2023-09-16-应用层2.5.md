---
layout: post
title: 2.5 DNS
subtitle: 计网笔记
author: NightSheep
categories: 计网笔记
tags: [笔记,计网]
---
## DNS[^1]
---

### DNS 的必要性

- 我们使用IP地址来标识主机、路由器，但是IP地址本身无意义，不好记忆。
- 我们需要一种能进行主机名到IP地址转换的目录服务，这就是DNS。
- **DNS是**：
	- 一个由分层的DNS服务器实现的分布式数据库
	- 一个使得主机能够查询分布式数据库的应用层协议

### DNS的历史

- 起源：ARPANET的名字解析方案
	- 主机名：没有层次的一个字符串（一个平面）
	- 存在着一个集中维护站，维护着一张主机名-IP地址的映射文件：Host.txt
	- 每台主机定时从维护站取文件
- ARPANET解决方案的问题
	- 当网络中主机数量很大时
		- 没有层次的主机名称很难分配
		- 文件的管理、发布、查找都很麻烦

### DNS的思路和目标

- DNS的主要思路：
	- 分层的、基于域的命名机制
	- 若干分布式的数据库完成名字到IP地址的转换
	- 运行在UDP之上端口号为53的应用服务
	- 核心的Internet功能，但以应用层协议实现
		- 设计原理：在网络边缘处理复杂性
- DNS的主要目标：
	- 实现主机名-IP地址的转换
	- 其他目的
		- 主机别名到规范名字的转换
		- 邮件服务器别名到邮件服务器的正规名字的转换
		- 负载均衡

### DNS 名字空间

- DNS域名结构
	- 采用层次树状结构的命名方法
	- Internet根被划为几百个顶级域
		- 通用的：.com,.edu,.gov等
		- 国家的：.cn,.us,.jp等
	- 每个（子）域下面可划分若干子域
	- 树叶是主机
- 域名：
	- 从本域往上，直到树根
	- 中间使用”.“间隔不同的级别
	- 例如：hust.edu.cn
	- 域的域名：可以用来表示一个域
	- 主机的域名：一个域上的一个主机
- 域名的管理
	- 一个域管理其下的子域
		- .cn被划分为 edu.cn,com.cn
	- 创建一个新的域，必须征得它所属域的同意
- 域与物理网络无关
	- 域遵从组织界限，而不是物理网络
		- 一个域的主机可以不在一个网络
		- 一个网络的主机不一定在一个域
	- 域的划分是逻辑的，而不是物理的

### DNS服务器

- 仅有一个名字服务器的问题：
	- 可靠性问题：单点故障
	- 扩展性问题：通信容量
	- 维护问题：远距离的集中式数据库
- 分布式、层次数据库
	- 对于大量的DNS服务器通过层次方式组织
		- 根DNS服务器
			- 根名字服务器提供TLD[^2]服务器的IP地址
		- TLD DNS服务器
			- TLD服务器提供了权威DNS服务器的IP地址
		- 权威DNS服务器
	- 此外，还有本地DNS服务器
		- 并不严格属于层次结构
		- 每个ISP都有一个本地DNS服务器
			- 也称为”默认名字服务器“
		- 当一个主机发起一个DNS查询时，查询被送到其本地DNS服务器
			- 起着代理的作用，将查询转发到层次结构中

### DNS记录

- RR[^3]
	- 作用：维护域名-IP地址的映射关系
		- 或者是其他的一些映射
	- 位置：DNS服务器的分布式数据库中
	- 格式:$(Domain\_Name,TTL,Type,Class,Value_)$
		- `Domain_Name`:域名
		- `TTL`:生存时间，决定了资源记录应该从缓存中删除的时间
		- `Class`:类别。对于Internet值为IN
		- `Value`:可以是数字，域名或ASCII串
		- `Type`:资源记录的类型
			![资源记录类型](/assets/images/Snipaste_2023-09-16_20-35-14.png)

### DNS工作过程

1. 应用调用解析器
2. 解析器作为客户向DNS服务器发出查询报文（封装在UDP段中）
3. DNS服务器返回响应报文（name/IP）

### 域名解析过程

- 目标域名在本地DNS服务器中
	- 情况1：查询的域名在该区域内部
	- 情况2：缓存
		- 一旦DNS服务器学到了一个映射，就将该映射缓存起来
		- 根服务器通常都在本地服务器中缓存着
			- 使得根服务器不用经常被访问
		- 可能存在的问题：如果情况变化，缓存结果和权威资源记录不一致
			- 解决方案：TTL（默认2天）
- 当本地DNS服务器不能解析域名时，联系根DNS服务器顺着根-TLD一直找到权威DNS服务器

- 递归查询
	- 名字解析负担都放在当前联络的DNS服务器上
	- 根服务器的负担太重
![递归查询](/assets/images/Snipaste_2023-09-16_20-45-43.png)
- 迭代查询
	- 根（及各级域名）服务器返回的不是查询结果，而是下一个DNS服务器的地址
	- 最后由权威DNS服务器给出解析结果
![迭代查询](Snipaste_2023-09-16_20-49-18.png)

### DNS协议、报文

- **DNS协议**：查询和响应报文的报文格式相同
![](Snipaste_2023-09-16_20-54-44.png)
![](Snipaste_2023-09-16_20-55-07.png)

### DNS维护问题

- 新增一个域：
	- 在上级域的名字服务器中增加两条记录，指向这个新增的子域的域名和域名服务器的地址
	- 在新增子域的名字服务器上运行名字服务器，负责本域的名字解析：名字->IP地址
- 其他维护问题如删减，修改等也类似。

### DNS 安全问题

>总的来说，DNS是比较健壮的

- DDoS攻击
	- 对根服务器进行流量轰炸攻击：发送大量ping
		- 没有成功
		- 原因１：根目录服务器配置了流量过滤器，防火
		- 原因２：Local DNS 服务器缓存了TLD服务器的IP地址,因此无需查询根服务器
	- 向TLD服务器流量轰炸攻击：发送大量查询
		- 可能更危险
		- 效果一般，大部分DNS缓存了TLD
- 重定向攻击
	- 中间人攻击
		- 截获查询，伪造回答，从而攻击某个（DNS回答指定的IP）站点
	- DNS中毒
		- 发送伪造的应答给DNS服务器，希望它能够缓存这个虚假的结果
	- 技术上较困难：分布式截获和伪造
- 利用DNS基础设施进行DDoS
	- 伪造某个IP进行查询， 攻击这个目标IP
	- 查询放大，响应报文比查询报文大
	- 效果有限

## 名词解释
---

[^1]: DNS: *Domain Name System* 域名系统

[^2]: TLD: *Top Level Domain* 顶级域

[^3]: RR: *resource records* 资源记录