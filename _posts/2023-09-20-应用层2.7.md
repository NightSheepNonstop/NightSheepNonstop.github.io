---
layout: post
title: 2.7 CDN
subtitle: 计网笔记
author: NightSheep
categories: 计网笔记
tags: [笔记,计网]
---
## 因特网视频
---

- **视频**：固定速度显示的图像序列（每一幅图像称为一帧）
- 网络视频特点：
	- 高码率
	- 可以被压缩
	- 百分之九十以上的网络流量是视频
- **数字化图像**：像素的阵列
	- 每个像素被若干bits表示
- **编码**：使用图像内和图像间的冗余来降低编码的比特数
	- 空间冗余（图像内）
	- 时间冗余（相邻的图像间）
- **CBR**[^1]：以固定速率编码
- **VBR**[^2]：视频编码速率随时间的变化而变化

## 多媒体流化服务
---

### HTTP流

- 在HTTP流中，视频只是存储在HTTP服务器中作为一个普通的文件，每个文件有一个特定的URL。

- 当用户要看该视频时，客户与服务器创建一个TCP连接并发送对该URL的HTTP GET请求。服务器则在响应报文中发送该视频文件。在客户一侧字节被收集在客户应用缓存中。

- 一旦缓存中的字节数量超过预先设定的门限，客户应用程序就开始播放。

### DASH[^3]

- **服务器**：
	- 将视频文件分割成多个块
	- 每个块独立存储，编码于不同码率（8-10种）
	- 告示文件（*manifest file*）: 提供不同块的URL
- **客户端**：
	- 先获取告示文件
	- 周期性地测量服务器到客户端的带宽
	- 查询告示文件,在一个时刻请求一个块，HTTP头部指定字节范围
		- 如果带宽足够，选择最大码率的视频块
		- 会话中的不同时刻，可以切换请求不同的编码块 (取决于当时的可用带宽)

- “智能”客户端: 客户端自适应决定：
	- 什么时候去请求块 (不至于缓存挨饿，或者溢出)
	- 请求什么编码速率的视频块 (当带宽够用时，请求高质量的视频块)
	- 哪里去请求块 (可以向离自己近的服务器发送URL，或者向高可用带宽的服务器请求)

## CDN[^4]
---

- 服务器如何通过网络向上百万用户同时流化视频内容 (上百万视频内容)?
	1. 单个的、大的超级服务中心 “*mega server*“
		- 服务器到客户端路径上跳数较多，瓶颈链路的带宽小导致停顿
		- “二八规律”决定了网络同时充斥着同一个视频的多个拷贝，效率低（付费高、带宽浪费、效果差）
		- 单点故障点，性能瓶颈
		- 周边网络的拥塞
		- 简单但不可扩展
	2. 通过**CDN**，全网部署缓存节点，存储服务内容，就近为用户提供服务，提高用户体验
		- *enter deep*: 将CDN服务器深入到许多接入网
			- 更接近用户，数量多，离用户近，管理困难
		- *bring home*: 部署在少数(10个左右)关键位置，如将服务器簇安装于POP附近（离若干$1^{st}$ ISP POP较近）
			- 采用租用线路将服务器簇连接起来
		- 用户从CDN中请求内容：
			- 重定向到最近的拷贝，请求内容
			- 如果网络路径拥塞，可能选择不同的拷贝

## 名词解释
---

[^1]:CBR: *constant bit rate* 恒定比特率

[^2]:VBR: *variable bit rate* 可变比特率

[^3]:DASH: *Dynamic Adaptive Streaming over HTTP* 经HTTP的动态适应性流
[^4]:CDN: *Content Distribution Networks* 内容分发网