---
layout: post
title: 2.1 应用层协议原理
subtitle: 计网笔记
author: NightSheep
categories: 计网笔记
tags: [笔记,计网]
---
## 网络应用的体系结构
---

- 客户-服务器模式(C/S)
- 对等模式(P2P)
- 混合模式(C/S+P2P)

### 客户-服务器体系结构

- 服务器：
	- 一直运行
	- 固定的IP地址和周知的端口号（约定）
	- 扩展性：服务器场
		- 数据中心进行扩展
		- 扩展性差
- 客户端：
	- 主动与服务器通信
	- 与互联网有间歇性的连接
	- 可能是动态IP地址
	- 不直接与其它客户端通信

### 对等体系结构

- 几乎没有一直运行的服务器
- 任何端系统之间可以进行通信
- 每一个节点既是客户端又是服务器
	- 自扩展性-新的peer节点带来新的服务能力，当然也带来新的服务请求
- 参与的主机间歇性连接且可以改变IP地址
	- 难以管理
- 例子：迅雷，电驴

### 混合体系结构

- Napster
	- 文件搜索：集中
		- 主机在中心服务器上注册其资源
		- 主机向中心服务器查询资源位置
	- 文件传输：P2P
		- 任意Peer节点之间

- 即时通信
	- 在线检测：集中
		- 当用户上线时，向中心服务器注册其IP地址
		- 用户与中心服务器联系，以找到其在线好友的位置
	- 两个用户之间聊天：P2P

## 分布式进程通信
---

- **进程**：在主机上运行的应用程序
	- 客户端进程：发起通信的进程
	- 服务器进程：等待连接的进程
- 在同一个主机内，使用进程间通信机制通信（操作系统定义）
- 不同主机间通过交换报文来通信（分布式进程通信）
	- 使用操作系统提供的通信服务
	- 按照应用协议交换报文
		- 借助传输层提供的服务

###  如何进行进程标示和寻址

- **对进程进行编址**
- 进程为了接收报文，必须有一个标示，即：SAP（服务接入点）
	- 主机：唯一的32位IP地址
	- 所用的传输层协议（TCP/UDP)
	- 端口号（port）
		- 例如：
			- HTTP： TCP 80
			- Mail： TCP 25
			- ftp：TCP 2
 - 一个进程用IP+port标识端节点
 - 本质上，一对主机进程之间的通信由两个端节点构成

### 传输层如何向应用层提供服务

- 层间接口必须要携带的信息
	- 要传输的报文（对于本层来说：SDU）
		- SDU:*Service Data Unit*，服务数据单元
		- PDU:*Protocol Data Unit*，协议数据单元
		- 下层协议为上层协议提供服务，上层PDU变成下层SDU
       - 谁传的：自己的应用进程标示：IP+TCP(UDP)端口
       - 传给谁：对方的应用进程标示：对方的IP+TCP(UDP)端口号
- 传输层实体（TCP或UDP实体）根据这些信息进行TCP报文段（UDP数据报）的封装
	- 源端口号，目标端口号，数据等
	- 将IP地址往下交IP实体，用于封装IP数据报：源IP,目标IP

- **如果每次传输报文的时候都携带这么多信息过于繁琐易错！**
	- 用个代号标示通信的双方或者单方：socket（套接字）

- 套接字（socket）：
	- 进程向套接字发送报文或从套接字接收报文
	- 套接字是报文传输的门户

- TCP socket：
	- TCP服务：两个进程之间的通信需要之前要建立连接
		- 两个进程通信会持续一段时间，通信关系稳定
	 - 可以用一个整数表示两个应用实体之间的通信关系，**本地标示**。
	 - 穿过层间接口的信息量最小
	 - TCP socket：4元组（源IP，源端口，目标IP，目标端口）
	 - 唯一的指定了一个会话（2个进程之间的会话关系）
	 - 应用使用这个标示 ，与远程的应用进程通信
	 - 不必在每一个报文的发送都要指定这4元组
	 - 就像使用操作系统打开一个文件，OS返回一个文件句柄一样，以后使用这个文件句柄，而不是使用这个文件的目录名、文件名
	 - 简单，便于管理

- UDP socket：
	- UDP服务：两个进程之间的通信需要之前无需建立连接
		- 每个报文都是独立传输的
		- 前后报文可能给不同的分布式进程
	- 因此只能用一个整数表示本应用实体，**本地标示**
		- 因为报文的传输对象不确定
	 - 穿过层间接口的信息大小最小
	 - UDP socket：2元组（本IP,本端口）
	 - 但是传输报文时：必须要提供对方的IP和port
		 - 接收报文时： 传输层需要上传对方的IP和port
	 - UDP套接字指定了应用所在的一个端节点（*end point*）
	 - 在发送数据报时，采用创建好的本地套接字，就不必在发送每个报文中指明自己所采用的IP和port
	 - 但是在发送报文时，必须要指定对方的IP和UDP port(另外一个端节点)

### 如何使用传输层提供的服务实现应用

- 定义应用层协议：报文格式，解释，时序等
- 编制程序，通过API调用网络基础设施提供的通信服务传输报文，解析报文，实现应用时序等

## 应用层协议
---
- 定义了运行在不同端系统上的应用进程如何相互交换报文：
	- 交换的报文类型：请求和应答报文
	- 各种报文类型的语法：报文中的各个字段及其描述
	- 字段的语义：即字段取值的含义
	- 进程何时、如何发送报文及对报文进行响应的规则
- 应用协议仅仅是应用的一个组成部分
	- Web应用组成部分包括：HTTP协议，web客户端，web服务器，HTML

### 协议分类

- 公开协议
	- 由RFC文档定义
	- 允许互操作
	- 如：HTTP,SMTP

- 专用（私有）协议
	- 协议不公开
	- 如：Skype

## 传输层服务
---

### 服务要求

- 数据丢失率
	- 有些应用要求100%的可靠数据传输（如文件）
	- 有些应用（如音频）能容忍一定比例以下的数据丢失
- 延迟
	- 一些应用 出于有效性考虑，对数据传输有严格的时间限制
- 吞吐
	- 一些应用（如多媒体）必须需要最小限度的吞吐，从而使得应用能够有效运转
	- 一些应用能充分利用可供使用的吞吐(弹性应用)
- 安全性
	- 机密性
	- 完整性
	- 可认证性（鉴别）

### Internet 传输层提供的服务

- TCP服务：
	- 可靠的传输服务
	- 流量控制：发送方不会淹没接受方
	- 拥塞控制：当网络出现拥塞时，能抑制发送方
	- 不能提供的服务：时间保证、最小吞吐保证和安全
	- 面向连接：要求在客户端进程和服务器进程之间建立连接

- UDP服务：
	- 不可靠数据传输
	- 不提供的服务：可靠，流量控制、拥塞控制、时间、带宽保证、建立连接
	- UDP存在的必要性：
		- 能够区分不同的进程，而IP服务不能
		- 无需建立连接，省去了建立连接时间，适合事务性的应用
		- 不做可靠性的工作，例如检错重发，适合那些对实时性要求比较高而对正确性要求不高的应用
			- 因为为了实现可靠性（准确性、保序等），必须付出时间代价（检错重发）
		- 没有拥塞控制和流量控制，应用能够按照设定的速度发送数据

### 安全TCP

- TCP和UDP都没有加密，明文（甚至密码）通过互联网传输

- **SSL**
	- 在TCP上面实现，提供加密的TCP连接
	- 私密性
	- 数据完整性
	- 端到端的鉴别
	- 在应用层。应用采用SSL库，SSL库使用TCP通信
	- 应用通过API将明文交给socket，SSL将其加密在互联网上传输