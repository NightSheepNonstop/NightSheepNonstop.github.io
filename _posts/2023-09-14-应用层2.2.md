---
layout: post
title: 2.2 Web and HTTP
subtitle: 计网笔记
author: NightSheep
categories: 计网笔记
tags: [笔记,计网]
---
## Web 和 HTTP
---

### Web页

- Web页：由一些**对象**组成
- 对象可以是HTML文件、JPEF图像、Java小程序、声音剪辑文件等
- Web页含有一个基本的HTML文件，该基本HTML文件又包含若干对象的引用
- 通过URL对每个对象进行引用
- URL格式：
 $$\underbrace{Prot}_{协议名}://\underbrace{user:psw}_{用户：口令}@\underbrace{www.someSchool.edu}_{主机名}:\underbrace{port}_{端口}/\underbrace{someDept/pic.gif}_{路径名}$$

### HTTP概况

- HTTP：超文本传输协议
	- Web的应用层协议
	- 客户/服务器模式
	- HTTP 1.0:RFC 1945
	- HTTP 1.1:RFC 2068
- 使用TCP
	1. 客户发起一个与服务器的TCP连接 (建立套接字)，端口号为 80
	2. 服务器接受客户的TCP连接
	3. 在浏览器(HTTP客户端)与 Web服务器(HTTP服务器 server)交换HTTP报文 (应用层协议报文)
	4. TCP连接关闭
- HTTP是无状态的
	- 服务器并不维护关于客户的任何信息
	- 维护状态的协议是非常复杂的：
		- 必须维护历史信息(状态
		- 如果服务器/客户端死机，它们的状态信息可能不一致，二者的信息必须是一致的
		- 无状态的服务器能够支持更多的客户端

### HTTP连接

- 响应时间模型
	- RTT[^1] :一个小的分组从客户端到服务器，再回到客户端的时间（传输时间忽略）
	 - 响应时间：
		 - 一个RTT用来发起TCP连接
		 - 一个RTT用来HTTP请求并等待HTTP相应
		 - 文件传输时间
		 - 共：2RTT+传输时间

- 非持久HTTP
	- 最多只有一个对象在TCP连接上发送
	- 下载多个对象需要多个TCP连接
	- 每个对象要2个RTT
	- 操作系统必须要为每个TCP连接分配资源
	- 但浏览器通常打开并行TCP连接，以获取引用对象
	- HTTP/1.0使用非持久连接
- 持久HTTP
	- 服务器在发送响应后，仍保持TCP连接
	- 在相同客户端和服务器之间的后续请求和响应报文通过相同的连接进行传送
	- 多个对象可以在一个（在客户端和服务器之间的）TCP连接上传输
	- HTTP/1.1默认使用持久连接
	- 非流水方式的持久HTTP
		- 客户端只能在收到前一个响应后才能发出新的请求
		- 每个引用对象花费一个RTT
	- 流水方式的持久HTTP
		- HTTP/1.1的默认模式
		- 客户端遇到一个引用对象就立即产生一个请求
		- 所有引用（小）对象只花费一个RTT是可能的

### HTTP报文

- 两种类型的HTTP报文:**请求**、**响应**
- **HTTP请求报文**
	- ASCII格式（可读性）
	- 例：
		![请求报文](/assets/images/Snipaste_2023-09-14_22-38-17.png)
	 - 提交表单输入
		 - Post方式：
			 - 网页通常包括表单输入
			 - 包含在实体主体(entity body )中的输入被提交到服务器
		- URL方式
			- 方法：GET
			- 输入通过请求行的URL字段上载
	- 方法类型：
		- HTTP/1.0:
			- GET
			- POST
			- HEAD
				- 要求服务器在响应报文中不包含请求对象
		- HTTP/1.1
			- GET
			- POST
			- HEAD
			- PUT
				- 将实体主体中的文件上载到URL字段规定的路径
			- DELETE
				- 删除URL字段规定的文件
- **HTTP响应报文**
	- 例: ![响应报文](/assets/images/Snipaste_2023-09-14_22-46-13.png)
	- HTTP响应状态码：位于服务器-> 客户端的响应报文的首行。例：
		- 200 OK
			- 请求成功，请求对象包含在响应报文的后续部分
		- 301 Moved Permanently
			- 请求的对象已经被永久转移了；新的URL在响应报文的Location首部行中指定
			- 客户端软件自动用新的URL去获取对象
		- 404 Not Found
			- 请求的文档在该服务上没有找到

## 用户服务器状态：Cookies
---

- 四个组成部分
	1. 在HTTP响应报文中有一个cookie的首部行
	2. 在HTTP请求报文含有一个cookie的首部行
	3. 在用户端系统中保留有一个cookie文件，由用户的浏览器管理
	4. 在Web站点有一个后端数据库

- Cookies的用处：
	- 用户验证
	- 购物车
	- 推荐
	- 用户状态

- 如何维持状态：
	- 协议端节点：在多个事务上，发送端和接收端维持状态
	- cookies: http报文携带状态信息

- Cookies会带来一定的隐私安全问题

## Web缓存（代理服务器）
---

- 目标：不访问原始服务器，就满足客户的请求
- 用户设置浏览器：通过缓存访问Web
- 浏览器将所有的HTTP请求发给缓存
	- 在缓存中的对象：缓存直接返回对象（命中）
	- 不在缓存中的对象：缓存请求原始服务器，然后再将对象返回给客户端
- 缓存既是客户端又是服务器
	- 缓存返回对象时为服务器，请求对象时为客户端
- 通常缓存由ISP安装
- Web缓存的好处
	- 降低客户端的请求响应时间
	- 可以大大减少一个机构内部网络与Internent接入链路上的流量
	- 互联网大量采用了缓存，可以使较弱的ICP也能够有效提供内容
	- 相较更换更快的接入链路这一措施而言更为廉价

- 一致性问题：缓存区中的对象与原始服务器可能不同
	- 解决方法：条件GET方法
- 条件GET方法
	- 目标：如果缓存器中的对象拷贝是最新的，就不要发送对象
	![条件GET方法](/assets/images/Snipaste_2023-09-14_23-05-27.png)

## 名词解释
---

[^1]: RTT: *round trip time* 往返时间

